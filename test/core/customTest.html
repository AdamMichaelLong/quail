<!doctype html>
<html>

<head>
  <title>Adding custom tests to QUAIL</title>
</head>

<body>
  <div class="test-area">
    <p>This is a paragraph.</p>
    <p class="error">This is a paragraph we are testing for.</p>
    <h2 class="callback-error">Heading!</h2>

  </div>
  <script src="../testrunner.js"></script>
  <script>
    (function(global) {
      global.quailTest = function() {
        test('A custom test can be defined and run', function() {
          var testResults = [];
          var custom = {
            customTestSelector : {
              type : 'selector',
              options: {
                selector : '.error'
              }
            },
            customTestCallback : {
              type : 'custom',
              callback : function(quail) {
                quail.html.find('p, h2').each(function() {
                  if($(this).hasClass('callback-error')) {
                    quail.testFails('customTestCallback', $(this));
                  }
                });
              }
            }
          };
          $('.test-area').quail({ jsonPath : '../../dist',
                              guideline : [ 'customTestSelector', 'customTestCallback' ],
                              reset : true,
                              customTests : custom,
                              complete : function(results) {
                                testResults = results.results;
                              }});
          equal(true, testResults.customTestSelector.elements[0].is('p'), 'Found paragraph with selector');
          equal(true, testResults.customTestCallback.elements[0].is('h2'), 'Found header with custom callback');
        });
      };
    })(this);
  </script>
</body>

</html>